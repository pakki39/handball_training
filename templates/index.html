<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Handball</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
  </head>
  <body>
    <header class="topbar">
      <div class="topbar-left">
        <div class="app-title">Video Organizer</div>
        <nav class="tabs" aria-label="Navigation">
          <button id="tabOrganizerBtn" class="tab-btn active" type="button">Organizer</button>
          <button id="tabDublettenBtn" class="tab-btn" type="button">Dubletten</button>
        </nav>
      </div>
      <div id="envInfo" class="env-info"></div>
      <div id="status" class="status"></div>
    </header>

    <main id="tabOrganizer" class="container tab-page active">
      <section class="left">
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">Dateibrowser</div>
            <div class="tag-search-controls">
              <input id="tagQuery" class="input" type="text" placeholder="Tags suchen (z.B. Abwehr Angriff)" />
              <select id="tagDropdown" class="select">
                <option value="">Tag auswählen…</option>
              </select>
              <label class="tag-mode"><input id="noTagsFilter" type="checkbox" /> Ohne Tags</label>
              <input id="nameQuery" class="input" type="text" placeholder="Dateiname suchen (z.B. canayer)" />
              <button id="nameSearchBtn" class="btn" type="button">Name suchen</button>
              <label class="tag-mode"><input type="radio" name="tagMode" value="and" checked /> UND</label>
              <label class="tag-mode"><input type="radio" name="tagMode" value="or" /> ODER</label>
              <button id="tagSearchBtn" class="btn btn-primary" type="button">Suchen</button>
              <button id="tagRescanBtn" class="btn" type="button">Rescan</button>
              <span id="tagIndexStatus" class="tag-index-status"></span>
            </div>
          </div>

          <div class="panel-body">
            <div class="browser-split">
              <div class="browser-list">
                <div class="browser-lists">
                  <div class="tag-results-wrap">
                    <div class="panel-subtitle" style="padding: 2px 0 6px 2px;">Tag-Suche (Scan: <span id="tagScanRootLabel"></span>)</div>
                    <div id="tagResultsList" class="list"></div>
                  </div>
                  <div id="browserHSplitter" class="splitter-h"></div>
                  <div class="folder-wrap">
                    <div id="folderList" class="list"></div>
                  </div>
                </div>
              </div>
              <div class="video-player-wrap">
                <div id="playerMsg" class="player-msg"></div>
                <div id="tagEditor" class="tag-editor">
                  <div class="tag-editor-top">
                    <div class="panel-subtitle">Tags (Dateiname)</div>
                    <div id="tagEditorHint" class="tag-editor-hint"></div>
                  </div>
                  <div id="videoTags" class="tag-chips"></div>
                  <div class="tag-editor-add">
                    <select id="tagAssignDropdown" class="select">
                      <option value="">Tag zuweisen…</option>
                    </select>
                    <select id="tagRemoveDropdown" class="select">
                      <option value="">Tag entfernen…</option>
                    </select>
                    <button id="sourceSelectionClearBtn" class="btn" type="button" disabled>Auswahl löschen</button>
                    <button id="sourceSelectionSelectAllResultsBtn" class="btn" type="button" disabled>Alle markieren</button>
                    <input id="tagEditInput" class="input" type="text" placeholder="Tag hinzufügen…" list="tagSuggestions" />
                    <datalist id="tagSuggestions"></datalist>
                    <button id="tagAddBtn" class="btn" type="button">Hinzufügen</button>
                  </div>
                </div>
                <div id="clipEditor" class="clip-editor">
                  <div class="clip-editor-top">
                    <div class="panel-subtitle">Clips (Marker → Segmente)</div>
                    <div id="clipEditorHint" class="clip-editor-hint"></div>
                  </div>
                  <div class="clip-editor-controls">
                    <button id="markerAddBtn" class="btn" type="button">Marker setzen</button>
                    <button id="markerClearBtn" class="btn" type="button">Marker leeren</button>
                    <button id="createAllClipsBtn" class="btn btn-primary" type="button">Alle Clips erstellen</button>
                  </div>
                  <div class="clip-editor-body">
                    <div>
                      <div class="panel-subtitle" style="padding: 4px 0 6px 2px;">Marker</div>
                      <div id="markerList" class="clip-list"></div>
                    </div>
                  </div>
                </div>
                <div id="markerTimeline" class="marker-timeline" tabindex="0"></div>
                <video id="videoPlayer" controls preload="metadata" draggable="true"></video>
              </div>
            </div>
          </div>
        </div>
      </section>

      <aside class="right panel">
        <div class="panel-header">
          <div class="queue-header">
            <div class="panel-title" style="padding: 6px 0 8px 0;">Queue (Drop Zone)</div>
            <div style="display:flex; gap:8px; align-items:center;">
              <select id="mergeProfile" class="select">
                <option value="android_small" selected>Android (klein)</option>
                <option value="copy">Original (Copy)</option>
              </select>
              <label class="tag-mode"><input id="queueSelectAllCb" type="checkbox" /> Alle</label>
              <button id="queueDownloadSelectedBtn" class="btn" type="button" disabled>Download (Auswahl)</button>
              <button id="mergeDownloadBtn" class="btn btn-primary" type="button">Download (Merge)</button>
              <button id="queueClearAll" class="btn" type="button">Alle löschen</button>
            </div>
          </div>
          <div id="mergeProgressWrap" style="margin-top: 8px; display:none;">
            <div class="progress">
              <div id="mergeProgressBar" class="progress-bar" style="width:0%"></div>
            </div>
            <div id="mergeProgressText" class="progress-text"></div>
          </div>
        </div>

        <div class="panel-body">
          <div id="dropZone" class="dropzone">
            <div class="dropzone-hint">Videos hierher ziehen</div>
            <div id="queueList" class="queue"></div>
          </div>
        </div>
      </aside>
    </main>

    <main id="tabDubletten" class="container tab-page">
      <div class="panel tab-placeholder">
        <div class="panel-header">
          <div class="panel-title">Dubletten</div>
          <div class="dedupe-controls">
            <select id="dedupeDir" class="select"></select>
            <button id="dedupeSearchBtn" class="btn btn-primary" type="button">Suche starten</button>
            <button id="dedupeMoveAllBtn" class="btn" type="button" disabled>Alle Duplikate verschieben</button>
          </div>
        </div>
        <div class="panel-body">
          <div id="dedupeSummary" class="panel-subtitle" style="padding: 2px 0 8px 2px;"></div>
          <div id="dedupeStatusLine" class="dedupe-statusline">
            <span id="dedupeSpinner" class="dedupe-spinner" aria-hidden="true"></span>
            <span id="dedupeRunText" class="dedupe-runtext"></span>
            <span id="dedupeLastPoll" class="dedupe-ts"></span>
            <span id="dedupeLastUpdate" class="dedupe-ts"></span>
          </div>
          <div id="dedupeLog" class="dedupe-log"></div>
          <div id="dedupeResults" class="list"></div>
        </div>
      </div>
    </main>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
  </body>
</html>
